<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rebeca Store — Top-up Game</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#07070a; --card:#0f1720; --muted:#9aa6b2; --accent:#ff3b6b; --accent-2:#6a8cff;
    --glass: rgba(255,255,255,0.03);
    --radius:14px; --maxw:1100px; font-family:Inter,system-ui,Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#020205,#07101a 60%);color:#e9f0fb}
  .wrap{max-width:var(--maxw);margin:28px auto;padding:20px}
  header{display:flex;align-items:center;gap:14px}
  .logo{display:flex;align-items:center;gap:12px}
  .mark{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:800}
  h1{font-size:18px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .topbar{display:flex;gap:12px;align-items:center;margin-top:18px}
  .search{flex:1;display:flex;align-items:center;gap:10px;background:var(--card);padding:10px;border-radius:12px}
  .search input{background:transparent;border:0;outline:none;color:inherit;width:100%}
  .filters{display:flex;gap:8px}
  button.btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:0;padding:10px 14px;border-radius:10px;color:white;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  main{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:20px}
  .catalog{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:12px;display:flex;gap:12px;align-items:center}
  .thumb{width:72px;height:72px;border-radius:10px;background:linear-gradient(135deg,#111827,#0b1220);display:grid;place-items:center;font-weight:800}
  .card h3{margin:0;font-size:15px}
  .card p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .price{margin-left:auto;text-align:right}
  .price .num{font-weight:800}
  .sidebar{position:sticky;top:28px;padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px}
  .cart-list{display:flex;flex-direction:column;gap:10px;max-height:300px;overflow:auto;margin-top:10px}
  .cart-item{display:flex;gap:10px;align-items:center}
  .total{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}
  /* modal */
  .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);padding:20px}
  .modal{width:100%;max-width:560px;background:linear-gradient(180deg,#071017,#0b1115);padding:18px;border-radius:12px;color:inherit}
  input.flat, select.flat{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .small{font-size:13px;color:var(--muted)}
  @media (max-width:900px){ main{grid-template-columns:1fr} .catalog{grid-template-columns:1fr} .sidebar{position:relative;order:2} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <div class="mark">R</div>
        <div><h1>Rebeca Store</h1><p class="lead">Top-up Game • DANA & QRIS (demo)</p></div>
      </div>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <div id="userArea" style="display:flex;gap:8px;align-items:center">
          <button class="ghost" id="btnProfile" style="display:none"></button>
          <button class="ghost" id="btnLogin">Login</button>
          <button class="btn" id="btnRegister">Register</button>
        </div>
        <button class="btn" id="btnCheckout">Checkout</button>
      </div>
    </header>

    <div class="topbar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle></svg>
        <input id="search" placeholder="Cari: nama game, paket, nominal..." />
      </div>
      <div class="filters">
        <select id="gameFilter" class="flat"><option value="all">Semua Game</option><option value="freefire">Free Fire</option><option value="ml">Mobile Legends</option><option value="pubg">PUBG</option></select>
        <button class="ghost" id="clearBtn">Reset</button>
      </div>
    </div>

    <main>
      <section>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="font-size:20px">Paket Top-up</h2>
          <div class="small">{Pilih paket lalu tambahkan ke keranjang}</div>
        </div>

        <div class="catalog" id="catalog"></div>
      </section>

      <aside class="sidebar">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-weight:700">Keranjang</div>
          <div style="margin-left:auto;color:var(--muted)" id="cartCount">0 item</div>
        </div>

        <div class="cart-list" id="cartList"></div>

        <div class="total">
          <div class="small">Total</div>
          <div style="font-weight:800;font-size:18px" id="cartTotal">Rp 0</div>
        </div>

        <button class="btn" style="width:100%;margin-top:12px" id="openCheckout">Bayar Sekarang</button>

        <div style="margin-top:14px;color:var(--muted);font-size:13px">Rebeca Store • Jaminan aman & cepat • Layanan 24/7</div>
      </aside>
    </main>

    <footer>© Rebeca Store — Demo client-only. Untuk produksi butuh backend & payment gateway nyata.</footer>
  </div>

  <!-- Modal: Login/Register -->
  <div class="modal-backdrop" id="authModal" aria-hidden>
    <div class="modal" role="dialog">
      <h3 id="authTitle">Login</h3>
      <div style="margin-top:8px;display:grid;gap:8px">
        <input id="authUsername" class="flat" placeholder="Username" />
        <input id="authPassword" class="flat" placeholder="Password" type="password" />
        <div style="display:flex;gap:8px">
          <button class="btn" id="authSubmit">Submit</button>
          <button class="ghost" id="authCancel">Batal</button>
        </div>
        <div class="small" id="authHint"></div>
      </div>
    </div>
  </div>

  <!-- Modal: Checkout -->
  <div class="modal-backdrop" id="checkoutModal" aria-hidden>
    <div class="modal" role="dialog">
      <h3>Checkout</h3>
      <div class="small" style="margin-top:6px">Periksa pesananmu. Ini masih simulasi — tidak melakukan pembayaran nyata.</div>

      <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
        <div><div class="small">Ringkasan</div><div style="font-weight:700" id="summaryItems">0 item</div></div>
        <div style="text-align:right"><div class="small">Total</div><div style="font-weight:800;font-size:18px" id="modalTotal">Rp 0</div></div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Pilih Metode Pembayaran</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="ghost payMethod active" data-method="dana">DANA</button>
          <button class="ghost payMethod" data-method="qris">QRIS</button>
        </div>

        <div id="paymentArea" style="margin-top:12px">
          <div class="qr" id="qrBox" style="width:220px;height:220px;background:#08121a;border-radius:10px;display:grid;place-items:center;color:var(--muted)">
            Tampilkan QR di sini
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button class="btn" id="confirmPay">Saya sudah bayar</button>
            <button class="ghost" id="cancelPay">Batal</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========== Data sample ========== */
const PACKAGES = [
  {id:1, game:'freefire', title:'Diamond FF 50', price:12000, desc:'50 Diamond + bonus'},
  {id:2, game:'freefire', title:'Diamond FF 125', price:30000, desc:'125 Diamond'},
  {id:3, game:'ml', title:'Diamonds ML 50', price:11000, desc:'50 Diamonds'},
  {id:4, game:'ml', title:'Diamonds ML 100', price:21000, desc:'100 Diamonds'},
  {id:5, game:'pubg', title:'UC PUBG 60', price:17000, desc:'60 UC'},
  {id:6, game:'freefire', title:'Voucher 30k', price:30000, desc:'Voucher semua game'},
  {id:7, game:'freefire', title:'Bundle Lucky', price:50000, desc:'Paket hemat'},
  {id:8, game:'pubg', title:'UC PUBG 120', price:35000, desc:'120 UC'},
  {id:9, game:'ml', title:'Season Pass ML', price:45000, desc:'Season pass'},
  {id:10, game:'freefire', title:'Diamond FF 600', price:150000, desc:'600 Diamond'},
  {id:11, game:'pubg', title:'Bundle Elite', price:80000, desc:'Skin & UC'},
  {id:12, game:'ml', title:'Hero Pack', price:95000, desc:'Paket hero + skin'}
];

/* ========== Helpers ========== */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const formatRupiah = n => 'Rp ' + String(n).replace(/\B(?=(\d{3})+(?!\d))/g,'.');

/* ========== State ========== */
let cart = [];
let currentUser = null; // {username}
let usersKey = 'rebeca_users_v1'; // stored in localStorage

/* ========== Render catalog & cart ========== */
function renderCatalog(list=PACKAGES){
  const catalog = $('#catalog'); catalog.innerHTML = '';
  list.forEach(p=>{
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="thumb">${p.title.split(' ')[0]}</div>
      <div>
        <h3>${p.title}</h3>
        <p>${p.desc} • ${p.game.toUpperCase()}</p>
        <div style="margin-top:8px"><button class="btn addBtn" data-id="${p.id}">Tambahkan</button></div>
      </div>
      <div class="price">
        <div class="num">${formatRupiah(p.price)}</div>
        <div class="small">Instant</div>
      </div>
    `;
    catalog.appendChild(div);
  });
}

function renderCart(){
  const cartList = $('#cartList'); cartList.innerHTML = '';
  if(cart.length===0){ cartList.innerHTML = '<div class="small" style="color:var(--muted)">Keranjang kosong</div>'; $('#cartCount').innerText='0 item'; $('#cartTotal').innerText='Rp 0'; return; }
  cart.forEach(item=>{
    const el = document.createElement('div'); el.className='cart-item';
    el.innerHTML = `
      <div style="width:48px;height:48px;border-radius:8px;background:#091016;display:grid;place-items:center">${item.title.split(' ')[0]}</div>
      <div style="flex:1">
        <div style="font-weight:700">${item.title}</div>
        <div class="small" style="color:var(--muted)">x${item.qty} • ${item.game.toUpperCase()}</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700">${formatRupiah(item.price * item.qty)}</div>
        <div style="margin-top:6px;display:flex;gap:6px;justify-content:flex-end">
          <button class="ghost cart-act" data-action="dec" data-id="${item.id}">-</button>
          <button class="ghost cart-act" data-action="inc" data-id="${item.id}">+</button>
          <button class="ghost cart-act" data-action="rm" data-id="${item.id}">Hapus</button>
        </div>
      </div>
    `;
    cartList.appendChild(el);
  });
  const count = cart.reduce((s,i)=>s+i.qty,0);
  const total = cart.reduce((s,i)=>s + i.qty * i.price,0);
  $('#cartCount').innerText = `${count} item`;
  $('#cartTotal').innerText = formatRupiah(total);
}

/* ========== Cart operations ========== */
function addToCart(id){
  const p = PACKAGES.find(x=>x.id===id);
  const e = cart.find(x=>x.id===id);
  if(e) e.qty++; else cart.push({...p, qty:1});
  renderCart();
}
function changeCart(id,action){
  const idx = cart.findIndex(x=>x.id===id);
  if(idx===-1) return;
  if(action==='inc') cart[idx].qty++;
  else if(action==='dec'){ cart[idx].qty--; if(cart[idx].qty<=0) cart.splice(idx,1) }
  else if(action==='rm') cart.splice(idx,1);
  renderCart();
}

/* ========== Search & filter ========== */
$('#search').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase();
  const f = $('#gameFilter').value;
  const filtered = PACKAGES.filter(p=>{
    if(f!=='all' && p.game!==f) return false;
    return p.title.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || p.game.toLowerCase().includes(q);
  });
  renderCatalog(filtered);
});
$('#gameFilter').addEventListener('change', ()=> $('#search').dispatchEvent(new Event('input')));
$('#clearBtn').addEventListener('click', ()=>{ $('#search').value=''; $('#gameFilter').value='all'; renderCatalog(); });

/* ========== Auth: simple client-side with Web Crypto SHA-256 ========== */
async function hashPassword(pw){
  const enc = new TextEncoder();
  const data = enc.encode(pw);
  const hashBuf = await crypto.subtle.digest('SHA-256', data);
  const hashArr = Array.from(new Uint8Array(hashBuf));
  return hashArr.map(b=>b.toString(16).padStart(2,'0')).join('');
}
function loadUsers(){ try{ return JSON.parse(localStorage.getItem(usersKey)||'[]'); }catch(e){ return []; } }
function saveUsers(list){ localStorage.setItem(usersKey, JSON.stringify(list)); }

async function registerUser(username, password){
  const users = loadUsers();
  if(users.find(u=>u.username===username)) return {ok:false, error:'Username sudah terpakai'};
  const hashed = await hashPassword(password);
  users.push({username, passwordHash:hashed, created_at: Date.now()});
  saveUsers(users); return {ok:true};
}
async function loginUser(username, password){
  const users = loadUsers();
  const u = users.find(x=>x.username===username);
  if(!u) return {ok:false, error:'User tidak ditemukan'};
  const h = await hashPassword(password);
  if(h !== u.passwordHash) return {ok:false, error:'Password salah'};
  currentUser = {username}; // minimal
  updateUserUI();
  return {ok:true};
}
function logoutUser(){
  currentUser = null; updateUserUI();
}
function updateUserUI(){
  const btnProfile = $('#btnProfile');
  const btnLogin = $('#btnLogin');
  const btnRegister = $('#btnRegister');
  if(currentUser){
    btnProfile.style.display='inline-block'; btnProfile.innerText = currentUser.username;
    btnLogin.style.display='none'; btnRegister.style.display='none';
  } else {
    btnProfile.style.display='none'; btnLogin.style.display='inline-block'; btnRegister.style.display='inline-block';
  }
}

/* ========== Modal behaviour ========== */
function openAuth(mode='login'){ $('#authModal').style.display='flex'; $('#authTitle').innerText = mode==='login'?'Login':'Register'; $('#authHint').innerText=''; $('#authUsername').value=''; $('#authPassword').value=''; $('#authSubmit').dataset.mode = mode; }
function closeAuth(){ $('#authModal').style.display='none'; }
$('#authCancel').addEventListener('click', closeAuth);
$('#btnLogin').addEventListener('click', ()=>openAuth('login'));
$('#btnRegister').addEventListener('click', ()=>openAuth('register'));
$('#authSubmit').addEventListener('click', async ()=>{
  const mode = $('#authSubmit').dataset.mode;
  const u = $('#authUsername').value.trim();
  const p = $('#authPassword').value;
  if(!u||!p){ $('#authHint').innerText='Isi username & password'; return; }
  if(mode==='register'){
    const r = await registerUser(u,p);
    if(!r.ok){ $('#authHint').innerText = r.error; } else { $('#authHint').innerText='Register sukses — silakan login'; openAuth('login'); }
  } else {
    const r = await loginUser(u,p);
    if(!r.ok){ $('#authHint').innerText = r.error; } else { $('#authHint').innerText='Login sukses'; closeAuth(); }
  }
});

/* quick logout by profile click (toggle) */
$('#btnProfile').addEventListener('click', ()=>{ if(confirm('Logout akun '+currentUser.username+'?')){ logoutUser(); } });

/* ========== Checkout modal ========== */
function openCheckoutModal(){
  if(cart.length===0){ alert('Keranjang kosong — tambahkan paket dahulu.'); return; }
  $('#checkoutModal').style.display='flex';
  $('#summaryItems').innerText = cart.map(i=>`${i.title} x${i.qty}`).join(', ');
  $('#modalTotal').innerText = formatRupiah(cart.reduce((s,i)=>s+i.price*i.qty,0));
  // default show DANA QR placeholder
  showPayment('dana');
}
function closeCheckout(){ $('#checkoutModal').style.display='none'; }

$$('.payMethod').forEach(btn=>btn.addEventListener('click', ()=>{ $$('.payMethod').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); showPayment(btn.dataset.method); }));

function showPayment(method){
  const box = $('#qrBox');
  if(method==='dana'){
    box.innerHTML = `<div style="text-align:center"><strong>DANA</strong><div class="small" style="margin-top:8px;color:var(--muted)">Scan QR di aplikasi DANA</div><div style="margin-top:10px;font-size:12px;color:var(--muted)">ID: 0812-3456-7890</div></div>`;
  } else {
    box.innerHTML = `<div style="text-align:center"><strong>QRIS</strong><div class="small" style="margin-top:8px;color:var(--muted)">Scan QRIS (simulasi)</div></div>`;
  }
}

/* confirm payment (simulated) */
$('#confirmPay').addEventListener('click', ()=>{
  if(!currentUser){ alert('Silakan login terlebih dahulu untuk melakukan pembayaran.'); closeCheckout(); return; }
  // simulate order creation and success
  alert('Pembayaran terdeteksi (simulasi). Terima kasih, pesanan sedang diproses.');
  // empty cart
  cart = []; renderCart(); closeCheckout();
});
$('#cancelPay').addEventListener('click', closeCheckout);

/* open checkout from header */
$('#openCheckout').addEventListener('click', openCheckoutModal);
$('#btnCheckout').addEventListener('click', openCheckoutModal);

/* global click listeners */
document.addEventListener('click', e=>{
  if(e.target.matches('.addBtn')) addToCart(parseInt(e.target.dataset.id));
  if(e.target.matches('.cart-act')) changeCart(parseInt(e.target.dataset.id), e.target.dataset.action);
});

/* initial render & state */
renderCatalog();
renderCart();
updateUserUI();

/* small: allow clicking outside modal to close */
['authModal','checkoutModal'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('click', e=>{ if(e.target===el) el.style.display='none'; });
});

/* expose some functions for console debugging (optional) */
window._rebeca = { addToCart, cart, registerUser, loginUser, loadUsers };
</script>
</body>
</html>